import{d as C,b as T}from"./pinia-D1tb24LR.js";import{a as A}from"./axios-Di5RpEPX.js";import{s as E}from"./sweetalert2-WZH64N0g.js";import{M as S}from"./bootstrap-fL-MoaV8.js";import{aR as n,a5 as r,a6 as e,aI as g,bz as I,bq as x,a_ as h,a4 as B,L as _,aY as P,ae as i,bx as y,aG as u,ba as q,bm as D,ad as z}from"./@vue-Cqo5QHyB.js";import{_ as w}from"./index-CoxUwXUV.js";import"./@ckeditor-DVmmUNiu.js";import"./vue-rznDyWWg.js";import"./@popperjs-WhmJkuoZ.js";import"./vue-axios-BaogFJPH.js";import"./vue-loading-overlay-DxSJf-C0.js";import"./vue-sweetalert2-BkTfjfvc.js";import"./vee-validate-CasJ09EL.js";import"./@vee-validate-DziBkgPq.js";/* empty css                        */import"./aos-BIKR1xpe.js";import"./vue-router-DOL1scXn.js";var L={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"wandererland",BASE_URL:"/test/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:$,VITE_PATH:j}=L,U=C("adminProducts",{state:()=>({allProducts:[],groupList:[]}),actions:{getAllProducts(){const s=`${$}/api/${j}/admin/products/all`;return A.get(s).then(t=>{this.allProducts=t.data.products,this.getGroupList()}).catch(t=>{E.fire({icon:"error",text:t.response.data.message})})},getGroupList(){const s=Object.values(this.allProducts),t=new Set(s.map(m=>m.group));this.groupList=[...t]}}});var N={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"wandererland",BASE_URL:"/test/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:R,VITE_PATH:G}=N,H={props:["isCover"],data(){return{modal:null,accept:["jpg","jpeg","png"],imgUrl:""}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()},handleFile(s){const t=s.target.files[0];if(t.size/(1024*1024)>3)return this.$swal.fire({icon:"error",text:"請上傳 3MB 以內的圖檔"}),this.resetDropArea(),!1;const o=t.type.split("/")[1];if(!this.accept.find(a=>a===o))return this.$swal.fire({icon:"error",text:"僅限使用 jpg、jpeg 與 png 格式圖檔"}),this.resetDropArea(),!1;this.uploadImage(t)},uploadImage(s){const t=this.$loading.show(),m=new FormData;m.append("file-to-upload",s),this.axios.post(`${R}/api/${G}/admin/upload`,m).then(f=>{this.imgUrl=f.data.imageUrl}).catch(f=>{this.$swal.fire({icon:"error",text:f.response})}).finally(()=>{t.hide()})},resetDropArea(){this.imgUrl="",this.$refs.dropArea.value=""},submitImgUrl(){this.isCover?this.$emit("submitImgUrl","imageUrl",this.imgUrl):this.$emit("submitImgUrl","imagesUrl",this.imgUrl),this.resetDropArea(),this.closeModal()}},mounted(){this.modal=new S(this.$refs.uploadImageModal,{keyboard:!1,backdrop:"static"})}},O={ref:"uploadImageModal",class:"modal fade","aria-hidden":"true","aria-labelledby":"uploadImageModal",tabindex:"-1"},F={class:"modal-dialog modal-lg modal-dialog-centered"},W={class:"modal-content"},Y={class:"modal-header"},J={key:0,class:"modal-title text-bold fw-bold"},K={key:1,class:"modal-title text-bold fw-bold"},Q=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),X={class:"modal-body container"},Z={class:"row g-3"},ee={class:"col-12 col-md-4"},te={class:"drop-area ratio-1x1"},oe={key:1},se={class:"col-12 col-md-8"},le=e("p",{class:"mb-1"},"僅限使用 jpg、jpeg 與 png 格式，檔案大小限制為 3MB 以下",-1),ie={ref:"imgForm"},ne=["accept"],re={class:"modal-footer"};function ae(s,t,m,f,o,d){return n(),r("div",O,[e("div",F,[e("div",W,[e("div",Y,[m.isCover?(n(),r("h5",J,"上傳封面")):(n(),r("h5",K,"上傳圖片")),Q]),e("div",X,[e("div",Z,[e("div",ee,[e("div",te,[o.imgUrl?(n(),r("div",{key:0,style:g(`background-image:url(${o.imgUrl})`),class:"w-100 h-100 bg-img-contain bg-img-center bg-img-norepeat"},null,4)):(n(),r("p",oe,"圖片預覽"))])]),e("div",se,[le,e("form",ie,[I(e("input",{class:"form-control mb-1",type:"text",placeholder:"請填入圖片網址","onUpdate:modelValue":t[0]||(t[0]=a=>o.imgUrl=a)},null,512),[[x,o.imgUrl]]),e("input",{class:"form-control",type:"file",ref:"dropArea",accept:o.accept,onChange:t[1]||(t[1]=(...a)=>d.handleFile&&d.handleFile(...a))},null,40,ne)],512)])])]),e("div",re,[e("button",{type:"button",class:"btn btn-dark",onClick:t[2]||(t[2]=(...a)=>d.submitImgUrl&&d.submitImgUrl(...a))},"送出")])])])],512)}const de=w(H,[["render",ae]]);var ce={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"wandererland",BASE_URL:"/test/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const b=U(),{VITE_API:me,VITE_PATH:ue}=ce,pe={data(){return{isNewProduct:!1,tempProductInfo:{},tempGroupList:[],isCover:!1,swalInfoCheckWithBootstrapButtons:null}},methods:{getProductInfo(s,t){this.tempProductInfo=s[t]},chooseGroup(s){this.tempProductInfo.group=s},deleteImage(s,t){s==="imageUrl"?this.tempProductInfo.imageUrl="":s==="imagesUrl"?this.tempProductInfo.imagesUrl.splice(t,1):(this.tempProductInfo.imageUrl="",this.tempProductInfo.imagesUrl=[])},openImageModal(s){s==="isCover"?this.isCover=!0:this.isCover=!1,this.$refs.uploadImageModal.openModal()},getImgUrl(s,t){if(s==="imageUrl"){this.tempProductInfo.imageUrl=t;return}this.tempProductInfo.imagesUrl?this.tempProductInfo.imagesUrl.push(t):this.tempProductInfo.imagesUrl=[t]},updateProductInfo(){let s=`${me}/api/${ue}/admin/product`;const t=this.isNewProduct?"post":"put";if(!this.tempProductInfo.imageUrl||!this.tempProductInfo.imagesUrl||this.tempProductInfo.imageUrl===""||!this.tempProductInfo.imagesUrl.length){this.swalInfoCheckWithBootstrapButtons.fire("圖片欄位為必填");return}this.isNewProduct||(s+=`/${this.tempProductInfo.id}`),this.isNewProduct&&(this.tempProductInfo.category="products",this.tempProductInfo.create_at=Math.floor(Date.now()/1e3)),this.tempProductInfo.size=this.tempProductInfo.size.replace("×","x"),this.axios[t](s,{data:this.tempProductInfo}).then(m=>{this.swalInfoCheckWithBootstrapButtons.fire(m.data.message),this.$router.push("/admin/products")}).catch(m=>{this.swalInfoCheckWithBootstrapButtons.fire({icon:"error",text:m.response.data.message,confirmButtonText:"確認"})})},async fetchData(s){try{if(await b.getAllProducts(),this.tempGroupList=[...b.groupList],!s)return;this.getProductInfo(b.allProducts,s)}catch(t){console.log(t.response.data.message)}}},computed:{...T(U)},components:{UploadImageModal:de},mounted(){const s=this.$route.params.id;s||(this.isNewProduct=!0),this.fetchData(s),this.swalInfoCheckWithBootstrapButtons=this.$swal.mixin({customClass:{confirmButton:"m-1 btn btn-default"},buttonsStyling:!1})}},fe={class:"overflow-y-scroll scrollbar-y-hide vh-100"},he={key:0,class:"py-4 py-md-7 fw-bold"},_e={key:1,class:"py-4 py-md-7 fw-bold"},be={class:"mb-7"},ge=e("h5",{class:"mb-3 fw-bold has-required"},"商品圖片",-1),Ie={class:"row g-1 mb-3"},ve={class:"col-6 col-md-2"},Pe={class:"ratio-1x1"},ye={class:"position-relative border border-1 h-100"},xe=e("i",{class:"bi bi-trash"},null,-1),we=[xe],Ue=e("div",{class:"position-absolute bottom-0 py-1 text-center text-white bg-dark opacity-75 w-100"}," 封面圖片 ",-1),ke={key:2,class:"h-100"},Ve=e("i",{class:"bi bi-image mb-2 text-default"},null,-1),Me=e("p",{class:"text-default"},"目前無封面",-1),Ce=[Ve,Me],Te={class:"position-relative border border-1 h-100"},Ae=["onClick"],Ee=e("i",{class:"bi bi-trash"},null,-1),Se=[Ee],Be={class:"col-6 col-md-2"},qe=e("i",{class:"bi bi-trash me-2"},null,-1),De=e("span",null,"刪除所有圖片",-1),ze=[qe,De],Le=e("h5",{class:"mb-5 fw-bold"},"商品基本資訊",-1),$e=e("label",{for:"title",class:"form-label fw-bold has-required"},"商品名稱",-1),je={class:"row g-5 g-md-1"},Ne={class:"col-md-6"},Re=e("label",{for:"artist",class:"form-label fw-bold has-required"},"藝術家",-1),Ge={class:"col-md-6"},He=e("label",{for:"size",class:"me-2 form-label fw-bold has-required"},"商品尺寸",-1),Oe={class:"row g-5 g-md-1"},Fe={class:"col-md-6"},We=e("label",{for:"quantity",class:"me-2 form-label fw-bold"},"作品版數",-1),Ye=e("span",{class:"fs-info text-info"},"若未填寫則不限版數",-1),Je={class:"col-md-6"},Ke=e("label",{for:"unit",class:"form-label fw-bold has-required"},"商品單位",-1),Qe=e("label",{for:"group",class:"form-label fw-bold has-required"},"商品分類",-1),Xe={class:"d-flex align-items-center text-nowrap fs-info"},Ze=e("span",{class:"text-info"},"點擊帶入分類：",-1),et={class:"d-flex gap-1 mb-0 flex-wrap"},tt=["onClick"],ot={class:"row g-3 g-md-1"},st={class:"col-md-6"},lt=e("label",{for:"origin_price",class:"form-label fw-bold has-required"},"原價",-1),it={class:"col-md-6"},nt=e("label",{for:"price",class:"form-label fw-bold has-required"},"售價",-1),rt=e("label",{for:"content",class:"form-label fw-bold"},"說明內容",-1),at={class:"form-check form-switch"},dt={class:"form-check-label",for:"is_enabled"},ct={key:0},mt={key:1},ut={class:"d-flex justify-content-end gap-2 pt-3"},pt=e("button",{type:"submit",class:"btn btn-dark text-white"},"確認",-1);function ft(s,t,m,f,o,d){const a=h("v-field"),p=h("error-message"),k=h("router-link"),V=h("v-form"),M=h("UploadImageModal");return n(),r(_,null,[e("div",fe,[o.isNewProduct?(n(),r("h2",he,"新增商品")):(n(),r("h2",_e,"編輯商品")),e("div",null,[e("div",be,[ge,e("div",Ie,[e("div",ve,[e("div",Pe,[e("div",ye,[o.tempProductInfo.imageUrl?(n(),r("button",{key:0,type:"button",class:"position-absolute top-0 end-0 d-flex justify-content-center align-items-center mt-2 me-2 btn btn-light",style:{width:"36px",height:"36px"},onClick:t[0]||(t[0]=c=>d.deleteImage("imageUrl",s.idx))},we)):B("",!0),Ue,o.tempProductInfo.imageUrl?(n(),r("div",{key:1,style:g(`background-image:url(${o.tempProductInfo.imageUrl})`),class:"h-100 bg-img-contain bg-img-center bg-img-norepeat"},null,4)):(n(),r("div",ke,[e("button",{onClick:t[1]||(t[1]=c=>d.openImageModal("isCover")),class:"d-flex flex-column align-items-center justify-content-center w-100 h-100 text-secondary btn btn-light rounded-0",type:"button"},Ce)]))])])]),(n(!0),r(_,null,P(o.tempProductInfo.imagesUrl,(c,l)=>(n(),r("div",{class:"col-6 col-md-2",key:l},[e("div",Te,[e("button",{type:"button",class:"position-absolute top-0 end-0 d-flex justify-content-center align-items-center mt-2 me-2 btn btn-light",style:{width:"36px",height:"36px"},onClick:v=>d.deleteImage("imagesUrl",l)},Se,8,Ae),e("div",{style:g(`background-image:url(${c})`),class:"h-100 bg-img-contain bg-img-center bg-img-norepeat"},null,4)])]))),128)),e("div",Be,[e("button",{onClick:t[2]||(t[2]=c=>d.openImageModal("inNotCover")),class:"d-flex align-items-center justify-content-center w-100 h-100 text-default btn btn-light rounded-0 ratio-1x1 border border-1",type:"button"}," 新增圖片 ")])]),e("button",{typs:"button",class:"p-0 btn text-danger",onClick:t[3]||(t[3]=(...c)=>d.deleteImage&&d.deleteImage(...c))},ze)]),e("div",null,[Le,i(V,{class:"d-flex flex-column gap-5",onSubmit:d.updateProductInfo},{default:y(({errors:c})=>[e("div",null,[$e,i(a,{type:"text",class:u(["form-control",{"is-invalid":c.名稱}]),placeholder:"請輸入商品名稱",modelValue:o.tempProductInfo.title,"onUpdate:modelValue":t[4]||(t[4]=l=>o.tempProductInfo.title=l),modelModifiers:{trim:!0},id:"title",name:"名稱",rules:"required"},null,8,["modelValue","class"]),i(p,{name:"名稱",class:"invalid-feedback"})]),e("div",je,[e("div",Ne,[Re,i(a,{id:"artist",name:"藝術家",type:"text",class:u(["form-control",{"is-invalid":c.藝術家}]),placeholder:"請輸入藝術家名稱",rules:"required",modelValue:o.tempProductInfo.artist,"onUpdate:modelValue":t[5]||(t[5]=l=>o.tempProductInfo.artist=l),modelModifiers:{trim:!0}},null,8,["class","modelValue"]),i(p,{name:"藝術家",class:"invalid-feedback"})]),e("div",Ge,[He,i(a,{id:"size",name:"尺寸",type:"text",class:u(["form-control",{"is-invalid":c.size}]),placeholder:"請輸入商品尺寸",min:"0",modelValue:o.tempProductInfo.size,"onUpdate:modelValue":t[6]||(t[6]=l=>o.tempProductInfo.size=l)},null,8,["class","modelValue"]),i(p,{name:"尺寸",class:"invalid-feedback"})])]),e("div",Oe,[e("div",Fe,[We,Ye,i(a,{id:"quantity",name:"quantity",type:"number",class:u(["form-control",{"is-invalid":c.quantity}]),placeholder:"請輸入作品版數",min:"0",modelValue:o.tempProductInfo.quantity,"onUpdate:modelValue":t[7]||(t[7]=l=>o.tempProductInfo.quantity=l),modelModifiers:{number:!0,trim:!0}},null,8,["class","modelValue"])]),e("div",Je,[Ke,i(a,{id:"unit",name:"單位",type:"text",class:u(["form-control",{"is-invalid":c.unit}]),placeholder:"請輸入商品單位",rules:"required",modelValue:o.tempProductInfo.unit,"onUpdate:modelValue":t[8]||(t[8]=l=>o.tempProductInfo.unit=l),modelModifiers:{trim:!0}},null,8,["class","modelValue"]),i(p,{name:"單位",class:"invalid-feedback"})])]),e("div",null,[e("div",null,[Qe,i(a,{type:"text",id:"group",name:"分類",class:u(["form-control mb-1",{"is-invalid":c.分類}]),placeholder:"請輸入商品分類",rules:"required",modelValue:o.tempProductInfo.group,"onUpdate:modelValue":t[9]||(t[9]=l=>o.tempProductInfo.group=l),modelModifiers:{trim:!0}},null,8,["class","modelValue"]),i(p,{name:"分類",class:"invalid-feedback"})]),e("div",Xe,[Ze,e("div",et,[(n(!0),r(_,null,P(o.tempGroupList,(l,v)=>(n(),r("button",{type:"button",class:"btn btn-light rounded-pill py-1 fs-info text-info",value:"item",key:v,onClick:ht=>d.chooseGroup(l)},q(l),9,tt))),128))])])]),e("div",ot,[e("div",st,[lt,i(a,{type:"number",id:"origin_price",name:"原價",class:u(["form-control",{"is-invalid":c.原價}]),placeholder:"請輸入原價",rules:"required",min:"0",modelValue:o.tempProductInfo.origin_price,"onUpdate:modelValue":t[10]||(t[10]=l=>o.tempProductInfo.origin_price=l),modelModifiers:{number:!0,trim:!0}},null,8,["class","modelValue"]),i(p,{name:"原價",class:"invalid-feedback"})]),e("div",it,[nt,i(a,{type:"number",id:"price",name:"售價",class:u(["form-control",{"is-invalid":c.售價}]),placeholder:"請輸入商品售價",rules:"required",min:"0",modelValue:o.tempProductInfo.price,"onUpdate:modelValue":t[11]||(t[11]=l=>o.tempProductInfo.price=l),modelModifiers:{number:!0,trim:!0}},null,8,["class","modelValue"]),i(p,{name:"售價",class:"invalid-feedback"})])]),e("div",null,[rt,I(e("textarea",{type:"text",id:"content",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":t[12]||(t[12]=l=>o.tempProductInfo.content=l),style:{height:"200px"}},null,512),[[x,o.tempProductInfo.content,void 0,{trim:!0}]])]),e("div",at,[I(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"is_enabled","onUpdate:modelValue":t[13]||(t[13]=l=>o.tempProductInfo.is_enabled=l)},null,512),[[D,o.tempProductInfo.is_enabled]]),e("label",dt,[o.tempProductInfo.is_enabled?(n(),r("span",ct,"更改為未上架")):(n(),r("span",mt,"更改為已上架"))])]),e("div",ut,[i(k,{to:"/admin/products",class:"btn btn-outline-dark"},{default:y(()=>[z("取消")]),_:1}),pt])]),_:1},8,["onSubmit"])])])]),i(M,{ref:"uploadImageModal",onSubmitImgUrl:d.getImgUrl,"is-Cover":o.isCover},null,8,["onSubmitImgUrl","is-Cover"])],64)}const St=w(pe,[["render",ft]]);export{St as default};
