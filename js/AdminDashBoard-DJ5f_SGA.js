import{d as M,b as O}from"./pinia-D1tb24LR.js";import{a as b}from"./axios-Di5RpEPX.js";import{s as v}from"./sweetalert2-WZH64N0g.js";import{d as B}from"./vue-loading-overlay-DxSJf-C0.js";import{u as S}from"./adminProductStore-K5YG__WE.js";import{L as R,B as j}from"./vue-chartjs-CdWNJvnm.js";import{C,a as P,b as y,P as N,c as V,p as x,d as A,e as $,f as Z}from"./chart.js-CYfGDqQG.js";import{_ as g}from"./index-DoNk55lq.js";import{a_ as p,aR as d,a5 as h,ae as _,a6 as t,ba as m,bz as T,bp as k,a4 as L}from"./@vue-Cqo5QHyB.js";import"./@ckeditor-DVmmUNiu.js";import"./vue-rznDyWWg.js";import"./@kurkle-BZxJdD1U.js";import"./vue-axios-BaogFJPH.js";import"./vue-sweetalert2-BkTfjfvc.js";import"./vee-validate-CasJ09EL.js";import"./@vee-validate-DziBkgPq.js";import"./bootstrap-fL-MoaV8.js";import"./@popperjs-WhmJkuoZ.js";/* empty css                        */import"./aos-BIKR1xpe.js";import"./vue-router-DOL1scXn.js";var H={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"wandererland",BASE_URL:"/test/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const I=B.useLoading(),{VITE_API:D,VITE_PATH:w}=H,E=M("adminOrders",{state:()=>({allOrderList:[],currentOrderList:[],pagination:{}}),actions:{resetAllOrderList(){return this.allOrderList=[],this.allOrderList},getAllOrderList(e=1){const o=`${D}/api/${w}/admin/orders?page=${e}`,r=I.show();return b.get(o).then(a=>{const{orders:s}=a.data;this.allOrderList=this.allOrderList.concat(s)}).catch(a=>{v.fire({icon:"error",text:a.response.data.message})}).finally(()=>r.hide())},getCurrentOrderList(e=1){const o=`${D}/api/${w}/admin/orders?page=${e}`;return b.get(o).then(r=>{const{orders:a,pagination:s}=r.data;this.currentOrderList=a,this.pagination=s}).catch(r=>{v.fire({icon:"error",text:r.response.data.message})})}}});C.register(P,y,N,V,x,A,$);const z={name:"LineChart",components:{LineChartComponent:R},props:{chartData:Object},data(){return{chartOptions:{responsive:!0,maintainAspectRatio:!1}}}},Y={style:{height:"300px"}},q=t("h3",{class:"mb-2 fs-6 fw-bold text-info"},"總銷售額",-1);function G(e,o,r,a,s,n){const i=p("LineChartComponent");return d(),h("div",Y,[q,_(i,{id:"my-chart-id",options:s.chartOptions,data:r.chartData},null,8,["options","data"])])}const U=g(z,[["render",G]]);C.register(x,A,$,Z,P,y);const F={name:"HorizontalBarChart",components:{Bar:j},props:{chartData:Object},data(){return{chartOptions:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y"}}}},J={style:{height:"300px"}},K=t("h3",{class:"mb-2 fs-6 fw-bold text-info"},"分類銷售額",-1);function Q(e,o,r,a,s,n){const i=p("Bar");return d(),h("div",J,[K,_(i,{id:"my-chart-id",options:s.chartOptions,data:r.chartData},null,8,["options","data"])])}const W=g(F,[["render",Q]]),l=E(),f=S(),X={data(){return{allProductList:[],allOrderList:[],isNotPaidOrder:[],isNotShippingOrder:[],needReplenishedProduct:[],chartMonthZone:3,turnOverData:{},groupSales:{}}},computed:{...O(S),...O(E)},watch:{chartMonthZone(){this.getMonthZone(this.chartMonthZone)}},methods:{getMonthZone(e=3){const o=new Date,r=o.getMonth()+1,a=o.getFullYear(),s=[];for(let n=0;n<e;n++){let i=r-n,c=a;i<=0&&(i+=12,c--),s.unshift(`${c.toString().slice(2,4)} ${i}月`)}this.getTurnOverData(s),this.getGroupSales(s)},getTurnOverData(e){const o={};l.allOrderList.forEach(a=>{const n=new Date(a.create_at*1e3).toLocaleString().split("/").splice(0,2),i=`${n[0].slice(2,4)} ${n[1]}月`;o[i]||(o[i]=0),Object.values(a.products).forEach(c=>{o[i]+=c.total})});const r=e.map(a=>o[a]||0);this.turnOverData={labels:e,datasets:[{label:"總銷售額",backgroundColor:"#333333",data:r}]}},getGroupSales(e){const o={};f.groupList.forEach(r=>{o[r]=0}),l.allOrderList.forEach(r=>{const s=new Date(r.create_at*1e3).toLocaleString().split("/").splice(0,2),n=`${s[0].slice(2,4)} ${s[1]}月`;e.forEach(i=>{i===n&&Object.values(r.products).forEach(c=>{const u=c.product.group;o[u]+=c.total})})}),this.groupSales={labels:Object.keys(o),datasets:[{label:"分類銷售額",backgroundColor:"#333333",data:Object.values(o)}]}},handleOrderData(){this.isNotPaidOrder=this.allOrderList.filter(e=>!e.is_paid),this.isNotShippingOrder=this.allOrderList.filter(e=>e.is_paid&&!e.is_shipping)},handleProductData(){this.needReplenishedProduct=this.allProductList.filter(e=>e.quantity&&e.quantity<=3)},async getAllOrderList(){await l.getCurrentOrderList();for(let e=0;e<l.pagination.total_pages;e++)await l.getAllOrderList(e+1);this.allOrderList=l.allOrderList,this.handleOrderData(),this.getMonthZone()},async getAllProductList(){await f.getAllProducts(),this.allProductList=Object.values(f.allProducts),this.handleProductData()}},async mounted(){await l.resetAllOrderList(),this.getAllOrderList(),this.getAllProductList()},components:{LineChart:U,HorizontalBarChart:W}},tt={class:"overflow-y-scroll scrollbar-y-hide vh-100"},et=t("h2",{class:"py-4 py-md-7 fw-bold"},"總覽",-1),st={class:"row g-1 p-2 p-md-3 mb-4 bg-light"},ot=t("div",{class:"col-12 col-md-3"},[t("div",{class:"p-3"},[t("h3",{class:"mb-1 fs-5 fw-bold"},"歡迎回來"),t("p",null,"這是您的待辦事項")])],-1),rt={class:"col-12 col-md-3"},at={class:"p-3 border rounded-2 bg-white"},it={class:"fs-3"},nt=t("h3",{class:"fs-6 fw-bold text-info"},"尚未付款的訂單",-1),ct={class:"col-12 col-md-3"},lt={class:"p-3 border rounded-2 bg-white"},dt={class:"fs-3"},ht=t("h3",{class:"fs-6 fw-bold text-info"},"待出貨的訂單",-1),pt={class:"col-12 col-md-3"},_t={class:"p-3 border rounded-2 bg-white"},ut={class:"fs-3"},mt=t("h3",{class:"fs-6 fw-bold text-info"},"即將售鑿商品",-1),ft={class:"p-2 p-md-3 bg-light"},gt=t("option",{value:"3",selected:""},"3 個月",-1),Ot=t("option",{value:"6"},"6 個月",-1),bt=t("option",{value:"12"},"12 個月",-1),vt=[gt,Ot,bt],Lt={class:"row g-3"},Dt={class:"col col-md-6"},wt={key:0,class:"w-100 p-3 pb-7 border rounded-2 bg-white"},St={class:"col col-md-6"},Ct={key:0,class:"w-100 p-3 pb-7 border rounded-2 bg-white"};function Pt(e,o,r,a,s,n){const i=p("LineChart"),c=p("HorizontalBarChart");return d(),h("div",tt,[et,t("div",st,[ot,t("div",rt,[t("div",at,[t("p",it,m(s.isNotPaidOrder.length),1),nt])]),t("div",ct,[t("div",lt,[t("p",dt,m(s.isNotShippingOrder.length),1),ht])]),t("div",pt,[t("div",_t,[t("p",ut,m(s.needReplenishedProduct.length),1),mt])])]),t("div",ft,[T(t("select",{class:"mb-5 form-select","aria-label":"selectMonthZone","onUpdate:modelValue":o[0]||(o[0]=u=>s.chartMonthZone=u),style:{width:"150px"}},vt,512),[[k,s.chartMonthZone]]),t("div",Lt,[t("div",Dt,[Object.values(s.turnOverData).length?(d(),h("div",wt,[_(i,{chartData:s.turnOverData},null,8,["chartData"])])):L("",!0)]),t("div",St,[Object.values(s.groupSales).length?(d(),h("div",Ct,[_(c,{chartData:s.groupSales},null,8,["chartData"])])):L("",!0)])])])])}const Ft=g(X,[["render",Pt]]);export{Ft as default};
